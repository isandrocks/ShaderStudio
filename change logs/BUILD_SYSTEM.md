# Shader Studio - Webpack Build System

This plugin now uses Webpack for building and bundling, following Figma plugin best practices.

## Project Structure

```
src/
├── app/                    # UI code (WebGL shader rendering)
│   ├── index.html         # HTML template
│   ├── index.ts           # UI entry point with WebGL logic
│   └── styles.css         # UI styles
└── plugin/                # Plugin code (Figma API logic)
    └── controller.ts      # Plugin controller entry point

dist/                      # Build output (generated by Webpack)
├── code.js               # Compiled plugin code
└── ui.html               # Compiled UI with inlined JS
```

## Build Commands

### Development Build with Watch Mode
```bash
npm run build:watch
```
- Automatically rebuilds on file changes
- Includes source maps for debugging
- Faster builds with transpileOnly mode

### Production Build
```bash
npm run build
```
- Minifies and optimizes code
- Removes source maps
- Smaller bundle sizes
- Ready for Figma plugin publication

### Legacy Command (still works)
```bash
npm run watch
```
Alias for `build:watch`

## Development Workflow

1. **Start watch mode:**
   ```bash
   npm run build:watch
   ```

2. **In Figma:**
   - Go to Plugins → Development → Import plugin from manifest
   - Select `manifest.json` from this directory
   - Changes to TypeScript files will auto-compile
   - Reload the plugin in Figma to test changes

3. **Edit files:**
   - UI code: `src/app/index.ts` and `src/app/styles.css`
   - Plugin code: `src/plugin/controller.ts`
   - HTML template: `src/app/index.html`

## Key Features of the Webpack Build

### Two-Bundle Architecture
- **`dist/code.js`**: Plugin controller with Figma API access (runs in sandbox)
- **`dist/ui.html`**: Self-contained HTML with inlined JavaScript and CSS (runs in iframe)

### Webpack Configuration Highlights
- **TypeScript Compilation**: `ts-loader` with `transpileOnly` for fast builds
- **CSS Processing**: `style-loader` + `css-loader` to inject styles into DOM
- **Inline Source Maps**: Required for Figma's sandbox in development mode
- **JS Inlining**: `HtmlWebpackInlineSourcePlugin` embeds all UI JS into HTML

### TypeScript Configuration
- Targets ES6 for modern browser support
- Includes DOM types for WebGL/Canvas APIs
- Module resolution set to "node" for proper imports
- Strict mode enabled for type safety

## Migration from Old System

The codebase was migrated from direct TypeScript compilation (`tsc`) to Webpack:

### Before (Old System)
- Single `ui.html` file with embedded `<script>` tags
- Direct compilation: `code.ts` → `code.js` via `tsc`
- Manual HTML/CSS/JS management

### After (Webpack System)
- Modular source files in `src/` directory
- Proper import/export system
- CSS can be imported in TypeScript
- Automated bundling and optimization
- Source maps for debugging

### Old Files (No Longer Used)
- `code.ts` → Moved to `src/plugin/controller.ts`
- `ui.html` → Split into `src/app/index.html`, `src/app/index.ts`, `src/app/styles.css`
- `code.js` → Now generated in `dist/code.js`

## Troubleshooting

### Build Errors
If you encounter build errors:
```bash
# Clean install dependencies
rm -rf node_modules package-lock.json
npm install
```

### Plugin Not Loading in Figma
1. Ensure you've run `npm run build` at least once
2. Check that `dist/code.js` and `dist/ui.html` exist
3. Verify `manifest.json` points to `dist/code.js` and `dist/ui.html`

### WebGL Errors
- Check browser console in Figma (Plugins → Development → Open Console)
- Verify shader syntax in the Advanced Editor
- Ensure canvas element is properly initialized

## Package Versions

Key dependencies:
- Webpack 4.39.1
- TypeScript 5.3.2
- ts-loader 6.0.4
- html-webpack-plugin 3.2.0
- html-webpack-inline-source-plugin 0.0.10

## Additional Resources

- [Figma Plugin API Documentation](https://www.figma.com/plugin-docs/)
- [Webpack Documentation](https://webpack.js.org/concepts/)
- [WEBPACK_BUILD_GUIDE.md](./WEBPACK_BUILD_GUIDE.md) - Detailed explanation of the Webpack setup
